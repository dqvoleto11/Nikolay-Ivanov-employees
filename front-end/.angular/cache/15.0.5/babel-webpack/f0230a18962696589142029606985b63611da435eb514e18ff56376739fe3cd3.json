{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { interval } from 'rxjs';\nimport { takeWhile } from 'rxjs/operators';\nlet AppComponent = class AppComponent {\n  constructor(api) {\n    this.api = api;\n    this.fileName = '';\n    this.selectedFile = null;\n    this.errorMsg = '';\n    this.progress = 0;\n    this.phase = 'idle';\n    this.summary = null;\n    this.details = [];\n  }\n  onFileSelected(event) {\n    var _a;\n    this.reset();\n    const input = event.target;\n    if ((_a = input.files) === null || _a === void 0 ? void 0 : _a.length) {\n      this.selectedFile = input.files[0];\n      this.fileName = this.selectedFile.name;\n    }\n  }\n  onProcess() {\n    if (!this.selectedFile) {\n      this.errorMsg = 'Please select a CSV file first.';\n      return;\n    }\n    this.errorMsg = '';\n    this.summary = null;\n    this.details = [];\n    this.startUploadSimulation();\n  }\n  startUploadSimulation() {\n    var _a;\n    this.phase = 'upload';\n    this.progress = 0;\n    (_a = this.timerSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n    this.timerSub = interval(500).pipe(takeWhile(() => this.progress < 100)).subscribe(() => {\n      var _a;\n      this.progress += 20;\n      if (this.progress >= 100) {\n        (_a = this.timerSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n        this.startProcessingSimulation();\n      }\n    });\n  }\n  startProcessingSimulation() {\n    var _a;\n    this.phase = 'processing';\n    this.progress = 0;\n    (_a = this.timerSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n    this.timerSub = interval(500).pipe(takeWhile(() => this.progress < 100)).subscribe(() => {\n      var _a;\n      this.progress += 20;\n      if (this.progress >= 100) {\n        (_a = this.timerSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n        this.callApi();\n      }\n    });\n  }\n  callApi() {\n    if (!this.selectedFile) return;\n    const fd = new FormData();\n    fd.append('file', this.selectedFile);\n    this.apiSub = this.api.processCsvWithProgress(fd).subscribe({\n      next: () => {},\n      error: err => {\n        this.errorMsg = err.error || 'Error processing CSV.';\n      },\n      complete: () => {\n        // response already handled by final event in subscribe stream\n      }\n    });\n    // actually perform simple post to get data\n    this.apiSub = this.api.processCsvWithProgress(fd).subscribe(event => {\n      var _a, _b;\n      if (event.type === 4) {\n        // HttpEventType.Response\n        this.summary = ((_a = event.body) === null || _a === void 0 ? void 0 : _a.summary) || null;\n        this.details = ((_b = event.body) === null || _b === void 0 ? void 0 : _b.details) || [];\n        this.phase = 'done';\n      }\n    });\n  }\n  reset() {\n    var _a, _b;\n    this.errorMsg = '';\n    this.phase = 'idle';\n    this.progress = 0;\n    (_a = this.timerSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n    (_b = this.apiSub) === null || _b === void 0 ? void 0 : _b.unsubscribe();\n  }\n  ngOnDestroy() {\n    var _a, _b;\n    (_a = this.timerSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n    (_b = this.apiSub) === null || _b === void 0 ? void 0 : _b.unsubscribe();\n  }\n};\nAppComponent = __decorate([Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})], AppComponent);\nexport { AppComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}